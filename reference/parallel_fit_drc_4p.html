<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fitting four-parameter dose response curves (using parallel processing) — parallel_fit_drc_4p • protti</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fitting four-parameter dose response curves (using parallel processing) — parallel_fit_drc_4p" />
<meta property="og:description" content="This function is a wrapper around fit_drc_4p that allows the use of all system cores for model fitting. It should only be used on systems that have enough memory available. 
Workers can either be set up manually before running the function with future::plan(multiprocess) or automatically by the function (maximum number of workers is 12 in this case). If workers are set up manually the 
number of cores should be provided to n_cores. Worker can be terminated after completion with future::plan(sequential). It is not possible to export the 
individual fit objects when using this function as compared to the non parallel function as they are too large for efficient export from the workers." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">protti</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/data_analysis_dose_response_workflow.html">Dose-Response Data Analysis Workflow</a>
    </li>
    <li>
      <a href="../articles/data_analysis_single_dose_treatment_workflow.html">Single Dose Treatment Data Analysis Workflow</a>
    </li>
    <li>
      <a href="../articles/quality_control_workflow.html">Qualtiy control (QC) workflow</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jpquast/protti/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fitting four-parameter dose response curves (using parallel processing)</h1>
    <small class="dont-index">Source: <a href='https://github.com/jpquast/protti/blob/master/R/parallel_fit_drc_4p.R'><code>R/parallel_fit_drc_4p.R</code></a></small>
    <div class="hidden name"><code>parallel_fit_drc_4p.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is a wrapper around <code>fit_drc_4p</code> that allows the use of all system cores for model fitting. It should only be used on systems that have enough memory available. 
Workers can either be set up manually before running the function with <code><a href='https://rdrr.io/pkg/future/man/plan.html'>future::plan(multiprocess)</a></code> or automatically by the function (maximum number of workers is 12 in this case). If workers are set up manually the 
number of cores should be provided to <code>n_cores</code>. Worker can be terminated after completion with <code><a href='https://rdrr.io/pkg/future/man/plan.html'>future::plan(sequential)</a></code>. It is not possible to export the 
individual fit objects when using this function as compared to the non parallel function as they are too large for efficient export from the workers.</p>
    </div>

    <pre class="usage"><span class='fu'>parallel_fit_drc_4p</span><span class='op'>(</span>
  <span class='va'>data</span>,
  <span class='va'>sample</span>,
  <span class='va'>grouping</span>,
  <span class='va'>response</span>,
  <span class='va'>dose</span>,
  filter <span class='op'>=</span> <span class='st'>"post"</span>,
  replicate_completeness <span class='op'>=</span> <span class='fl'>0.7</span>,
  condition_completeness <span class='op'>=</span> <span class='fl'>0.5</span>,
  correlation_cutoff <span class='op'>=</span> <span class='fl'>0.8</span>,
  log_logarithmic <span class='op'>=</span> <span class='cn'>TRUE</span>,
  retain_columns <span class='op'>=</span> <span class='cn'>NULL</span>,
  n_cores <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame containing at least the input variables.</p></td>
    </tr>
    <tr>
      <th>sample</th>
      <td><p>The name of the column containing the sample names.</p></td>
    </tr>
    <tr>
      <th>grouping</th>
      <td><p>The name of the column containing precursor, peptide or protein identifiers.</p></td>
    </tr>
    <tr>
      <th>response</th>
      <td><p>The name of the column containing response values, eg. log2 transformed intensities.</p></td>
    </tr>
    <tr>
      <th>dose</th>
      <td><p>The name of the column containing dose values, eg. the treatment concentrations.</p></td>
    </tr>
    <tr>
      <th>filter</th>
      <td><p>A character vector indicating if models should be filtered. The option <code>"pre"</code> is not available for
parallel fitting of models. This is because ANOVA adjusted p-values would be wrongly calculated because the dataset is split onto
multiple cores. Default is "post" and we recommend always using "post" because compared to "none" only some additional columns are 
added that contain the filter information. For ANOVA an adjusted p-value of 0.05 is used as a cutoff.</p></td>
    </tr>
    <tr>
      <th>replicate_completeness</th>
      <td><p>Similar to <code>completenss_MAR</code> of the <code>assign_missingness</code> function this argument sets a 
threshold for the completeness of data. In contrast to <code>assign_missingness</code> it only determines the completeness for one 
condition and not the comparison of two conditions. The threshold is used to calculate a minimal degree of data completeness. 
The value provided to this argument has to be between 0 and 1, default is 0.7. It is multiplied with the number of replicates 
and then adjusted downward. The resulting number is the minimal number of observations that a condition needs to have to be considered
"complete enough" for the <code>condition_completeness</code> argument.</p></td>
    </tr>
    <tr>
      <th>condition_completeness</th>
      <td><p>This argument determines how many conditions need to at least fulfill the "complete enough" criteria 
set with <code>replicate_completeness</code>. The value provided to this argument has to be between 0 and 1, default is 0.5. It is 
multiplied with the number of conditions and then adjusted downward. The resulting number is the minimal number of conditions that
need to fulfill the <code>replicate_completeness</code> argument for a peptide to pass the filtering.</p></td>
    </tr>
    <tr>
      <th>correlation_cutoff</th>
      <td><p>A numeric vector specifying the correlation cutoff used for data filtering.</p></td>
    </tr>
    <tr>
      <th>log_logarithmic</th>
      <td><p>logical indicating if a logarithmic or log-logarithmic model is fitted. 
If response values form a symmetric curve for non-log transformed dose values, a logarithmic model instead
of a log-logarithmic model should be used. Usually biological dose response data has a log-logarithmic distribution, which is the 
reason this is the default. Log-logarithmic models are symmetric if dose values are log transformed.</p></td>
    </tr>
    <tr>
      <th>retain_columns</th>
      <td><p>A vector indicating if certain columns should be retained from the input data frame. Default is not retaining 
additional columns <code>retain_columns = NULL</code>. Specific columns can be retained by providing their names (not in quotations marks, 
just like other column names, but in a vector).</p></td>
    </tr>
    <tr>
      <th>n_cores</th>
      <td><p>Optional, the number of cores used if workers are set up manually.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame is returned that contains correlations of predicted to measured values as a measure of the goodness of the curve fit, 
an associated p-value and the four parameters of the model for each group. Furthermore, input data for plots is returned in the columns <code>plot_curve</code> 
(curve and confidence interval) and <code>plot_points</code> (measured points).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If data filtering options are selected, data is filtered based on multiple criteria. In general, curves are only fitted 
if there are at least 5 conditions with data points present to ensure that there is potential for a good curve fit. Therefore, 
this is also the case if no filtering option is selected. Furthermore, a completeness cutoff is defined for filtering. By default 
each entity (e.g. precursor) is filtered to contain at least 70<!-- % of total replicates (adjusted downward) for at least 50% of  -->
all conditions (adjusted downward). This can be adjusted with the according arguments. In addition to the completeness cutoff, 
also a significance cutoff is applied. ANOVA is used to compute the statistical significance of the change for each entity. 
The resulting p-value is adjusted using the Benjamini-Hochberg method and a cutoff of q &lt;= 0.05 is applied. Curve fits that have 
a minimal value that is higher than the maximal value are excluded as they were likely wrongly fitted. Curves with a correlation 
below 0.8 are not passing the filtering. If a fit does not fulfill the significance or completeness cutoff, it has a chance to 
still be considered if half of its values (+/-1 value) pass the replicate completeness criteria and half do not pass it. In order 
to fall into this category, the values that fulfill the completeness cutoff and the ones that do not fulfill it need to be 
consecutive, meaning located next to each other based on their concentration values. Furthermore, the values that do not pass 
the completeness cutoff need to be lower in intensity. Lastly, the difference between the two groups is tested for statistical 
significance using a Welch's t-test and a cutoff of p &lt;= 0.1 (we want to mainly discard curves that falsly fit the other criteria 
but that have clearly non-significant differences in mean). This allows curves to be considered that have missing values in 
half of their observations due to a decrease in intensity. It can be thought of as conditions that are missing not 
at random (MNAR). It is often the case that those entities do not have a significant p-value since half of their conditions 
are not considered due to data missingness.</p>
<p>The final filtered list is ranked based on a score calculated on entities that pass the filter. The score is the negative log10 
of the adjusted ANOVA p-value scaled between 0 and 1 and the correlation scaled between 0 and 1 summed up and divided by 2. Thus,
the highest score an entity can have is 1 with both the highest correlation and adjusted p-value. The rank is corresponding to 
this score. Please note, that entities with MNAR conditions might have a lower score due to the missing or non-significant ANOVA 
p-value. You should have a look at curves that are TRUE for <code>dose_MNAR</code> in more detail.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'>parallel_fit_drc_4p</span><span class='op'>(</span>
<span class='va'>data</span>,
sample <span class='op'>=</span> <span class='va'>r_file_name</span>,
grouping <span class='op'>=</span> <span class='va'>eg_precursor_id</span>,
response <span class='op'>=</span> <span class='va'>intensity</span>,
dose <span class='op'>=</span> <span class='va'>concentration</span>
<span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jan-Philipp Quast, Dina Schuster.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


